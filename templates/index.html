<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processed Camera Feed</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        /* Prevent text selection for buttons */
        button {
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none;    /* Firefox */
            -ms-user-select: none;     /* IE10+/Edge */
            user-select: none;         /* Standard */
        }
    </style>
</head>
<body>
    <img id="processedImage" style="width:100%;" alt="Processed Frame" />

    <div id="controls" style="display: flex; flex-direction: column; align-items: center; margin-top: 20px;">
        <button id="up" onmousedown="sendControl('up', true)" onmouseup="sendControl('up', false)" 
                ontouchstart="sendControl('up', true)" ontouchend="sendControl('up', false)">↑</button>
        <div style="display: flex; justify-content: center; gap: 30px;">
            <button id="left" onmousedown="sendControl('left', true)" onmouseup="sendControl('left', false)" 
                    ontouchstart="sendControl('left', true)" ontouchend="sendControl('left', false)">←</button>
            <button id="right" onmousedown="sendControl('right', true)" onmouseup="sendControl('right', false)" 
                    ontouchstart="sendControl('right', true)" ontouchend="sendControl('right', false)">→</button>
        </div>
        <button id="down" onmousedown="sendControl('down', true)" onmouseup="sendControl('down', false)" 
                ontouchstart="sendControl('down', true)" ontouchend="sendControl('down', false)">↓</button>
    </div>

    <div id="scaleControls" style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
        <button id="scaleXPlus" onmousedown="sendControl('scaleXPlus', true)" onmouseup="sendControl('scaleXPlus', false)" 
                ontouchstart="sendControl('scaleXPlus', true)" ontouchend="sendControl('scaleXPlus', false)">ScaleX+</button>
        <button id="scaleXMinus" onmousedown="sendControl('scaleXMinus', true)" onmouseup="sendControl('scaleXMinus', false)" 
                ontouchstart="sendControl('scaleXMinus', true)" ontouchend="sendControl('scaleXMinus', false)">ScaleX-</button>
        <button id="scaleYPlus" onmousedown="sendControl('scaleYPlus', true)" onmouseup="sendControl('scaleYPlus', false)" 
                ontouchstart="sendControl('scaleYPlus', true)" ontouchend="sendControl('scaleYPlus', false)">ScaleY+</button>
        <button id="scaleYMinus" onmousedown="sendControl('scaleYMinus', true)" onmouseup="sendControl('scaleYMinus', false)" 
                ontouchstart="sendControl('scaleYMinus', true)" ontouchend="sendControl('scaleYMinus', false)">ScaleY-</button>
    </div>

    <script>
        var socket = io.connect();

        function sendControl(button, isPressed) {
            socket.emit('control', { button: button, isPressed: isPressed });
        }

        // Handle receiving the processed frame from the server
        socket.on('processed_frame', function(imageData) {
            document.getElementById('processedImage').src = imageData;
        });

        // Access the camera and send frames to the server
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({
                video: { facingMode: { exact: "environment" } }
            })
            .then(function(stream) {
                var video = document.createElement('video');
                video.srcObject = stream;
                video.play();

                var canvas = document.createElement('canvas');
                var context = canvas.getContext('2d');

                function sendFrameToServer() {
                    const targetWidth = 300;
                    const targetHeight = video.videoHeight * (targetWidth / video.videoWidth);

                    canvas.width = targetWidth;
                    canvas.height = targetHeight;

                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    var frameData = canvas.toDataURL('image/jpeg', 0.5);
                    
                    socket.emit('frame', frameData);
                }

                setInterval(sendFrameToServer, 75);
            })
            .catch(function(error) {
                console.error('Error accessing the camera: ', error);
            });
        } else {
            console.error('getUserMedia is not supported in this browser.');
        }
    </script>
</body>
</html>
